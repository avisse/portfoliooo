<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Maarch Courrier + OnlyOffice (Docker) | Steve Avisse</title>
  <meta name="description" content="Déploiement de Maarch Courrier (GED) sur Docker Compose avec PostgreSQL et intégration OnlyOffice DocumentServer (JWT). Stack reproductible, persistante et industrialisable.">
  <meta name="keywords" content="Maarch Courrier, OnlyOffice, Docker, Docker Compose, PostgreSQL, GED, DocumentServer, JWT, Debian 12, VirtualBox">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/icofont/icofont.min.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/venobox/venobox.css" rel="stylesheet">
  <link href="assets/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- Styles locaux (identiques au squelette demandé) -->
  <style>
    :root{
      --accent:#f2559e;
      --accent2:#007bff;
      --ink:#0b1420;
    }
    .lead-intro{ font-size:1.05rem; line-height:1.6; color:#4a5568; margin:6px 0 18px; }
    .accent{color:var(--accent); font-weight:700;}
    .tech-tags{margin:8px 0 18px; display:flex; flex-wrap:wrap; gap:8px;}
    .tag{
      background:rgba(242,85,158,.08); color:#b71862; border:1px solid rgba(242,85,158,.25);
      padding:4px 10px; border-radius:999px; font-size:.85rem; font-weight:600;
    }
    .btn-ghost{
      display:inline-block; padding:10px 14px; border-radius:10px; font-weight:600;
      border:2px solid var(--accent2); color:var(--accent2); text-decoration:none;
    }
    .btn-ghost:hover{ background:var(--accent2); color:#fff; }
    pre{ background:#0f172a; color:#e2e8f0; padding:14px; border-radius:12px; overflow:auto; }
    pre code{ font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size:.92rem; }
    .soft{ color:#94a3b8; }
    .faq-item{ border-bottom:1px solid #e9ecef; padding:14px 0; }
    .question{ cursor:pointer; font-weight:700; padding-right:24px; position:relative; color:#1f2937;}
    .answer{ max-height:0; overflow:hidden; transition:max-height .3s ease; }
    .arrow-icon{ position:absolute; right:0; top:0; transition:transform .3s ease; color:var(--accent2);}
    .answer-visible .arrow-icon{ transform:rotate(180deg); }
    .portfolio-details-carousel img{ border-radius:14px; }
  </style>
</head>

<body>

  <main id="main">
    <!-- ======= Portfolio Details ======= -->
    <section id="portfolio-details" class="portfolio-details">
      <div class="container" data-aos="fade-up">

        <div class="row">

          <!-- Colonne gauche : carrousel -->
          <div class="col-lg-8">
            <h2 class="portfolio-title" style="text-align:center; color: var(--accent2);">
              Maarch Courrier – GED dockerisée (+ OnlyOffice)
            </h2>

            <div class="owl-carousel portfolio-details-carousel">
              <img src="assets/img/maarch.png" class="img-fluid" alt="Assistant d’installation Maarch Courrier - prérequis">
              <img src="assets/img/maarch2.png" class="img-fluid" alt="Formulaire de base de données Maarch Courrier">
              <img src="assets/img/maarch4.png" class="img-fluid" alt="Initialisation de l’instance terminée">
              <img src="assets/img/maarch3.png" class="img-fluid" alt="Edition collaborative via OnlyOffice">
              <img src="assets/img/maarch5.png" class="img-fluid" alt="Image officielle Maarch Courrier">
            </div>
          </div>

          <!-- Colonne droite : résumé / tags / lien repo -->
          <div class="col-lg-4 portfolio-info">
            <h3 style="text-align:center"><strong>Docker : Maarch Courrier + OnlyOffice</strong></h3>

            <p class="lead-intro">
              Déploiement d’une <span class="accent">GED Maarch Courrier</span> sur <strong>Docker Compose</strong>
              avec <strong>PostgreSQL</strong>, volumes persistants et intégration
              <strong>OnlyOffice DocumentServer</strong> sécurisée par <strong>JWT</strong>.
              Objectif : une stack <strong>reproductible</strong>, <strong>maintenable</strong> et prête à l’industrialisation.
            </p>

            <div class="tech-tags">
              <span class="tag">Docker Compose</span>
              <span class="tag">Maarch Courrier</span>
              <span class="tag">PostgreSQL 16</span>
              <span class="tag">OnlyOffice</span>
              <span class="tag">JWT</span>
              <span class="tag">Debian/Ubuntu</span>
            </div>

            <ul style="margin-bottom:14px">
              <li><strong>Catégorie</strong> : GED / Gestion documentaire</li>
              <li><strong>Contexte</strong> : VM locale (Debian/Ubuntu) – déploiement Docker</li>
              <li><strong>Livrables</strong> : <code>compose.yml</code>, <code>.env</code>, volumes persistants, doc d’installation</li>
            </ul>

            <a class="btn-repo" href="https://github.com/avisse/Maarch-Projet" target="_blank" rel="noopener">
              <i class="bx bxl-github"></i> Voir le repository GitHub
            </a>
          </div>

          <!-- ======= Accordéons détaillés (pleine largeur) ======= -->
          <div class="col-lg-12 portfolio-info" style="margin-top:24px">

            <!-- 1) Contexte & objectifs -->
            <div class="faq-item">
              <div class="question" onclick="toggleAnswer('cx', this)">
                1) Contexte & objectifs
                <span class="arrow-icon">▼</span>
              </div>
              <div class="answer" id="cx">
                <p>
                  Fournir une GED <strong>Maarch Courrier</strong> opérationnelle avec <strong>édition collaborative</strong> via
                  <em>OnlyOffice DocumentServer</em>. Contraintes : déploiement <strong>rapide</strong>,
                  <strong>reproductible</strong>, <strong>isolé</strong> de l’OS, <strong>données persistantes</strong> et
                  maintenance simple — d’où le choix <strong>Docker + Docker Compose</strong>.
                </p>
                <ul>
                  <li>Livrables : <code>compose.yml</code>, <code>.env</code> simple, répertoires persistants (<em>docservers</em>, <em>custom</em>, BDD), OnlyOffice séparé et <strong>JWT</strong>.</li>
                </ul>
              </div>
            </div>

            <!-- 2) C’est quoi ces outils ? -->
            <div class="faq-item">
              <div class="question" onclick="toggleAnswer('a1', this)">
                2) C’est quoi ces outils ?
                <span class="arrow-icon">▼</span>
              </div>
              <div class="answer" id="a1">
                <h4>Maarch Courrier (GED / gestion du courrier)</h4>
                <ul>
                  <li>Fonctionnel : enregistrement, indexation, circuits de validation, recherche, archivage, export PDF…</li>
                  <li>Technique : <strong>PHP</strong> (front/API) + <strong>PostgreSQL</strong> + répertoires <em>docservers</em> & <em>custom</em>.</li>
                  <li>Intégrations classiques : LDAP, SMTP, scanners, parapheur.</li>
                </ul>
                <h4>OnlyOffice DocumentServer</h4>
                <ul>
                  <li>Édition collaborative Word/Excel/PowerPoint dans le navigateur.</li>
                  <li>Intégration via URL DocumentServer + <strong>JWT Secret</strong> (les fichiers restent côté Maarch).</li>
                </ul>
              </div>
            </div>

            <!-- 3) Architecture Docker retenue -->
            <div class="faq-item">
              <div class="question" onclick="toggleAnswer('a2', this)">
                3) Architecture Docker retenue
                <span class="arrow-icon">▼</span>
              </div>
              <div class="answer" id="a2">
                <ul>
                  <li>Réseau Docker commun.</li>
                  <li><strong>db-mc</strong> : PostgreSQL 16, volume persistant, healthcheck.</li>
                  <li><strong>app-mc</strong> : image officielle Maarch, volumes <em>docservers/custom/librairies</em>, port exposé (ex. 8080:80), healthcheck.</li>
                  <li><strong>onlyoffice</strong> : DocumentServer 8.3.3, port (ex. 4242:80), <strong>JWT activé</strong>.</li>
                </ul>
                <p><em>Pourquoi Docker ?</em> Isolation, reproductibilité, mises à jour simples (<code>pull</code> + <code>restart</code>), rollback, séparation code/config/données.</p>
              </div>
            </div>

            <!-- 4) Préparation de l’hôte -->
            <div class="faq-item">
              <div class="question" onclick="toggleAnswer('a3', this)">
                4) Préparation de l’hôte
                <span class="arrow-icon">▼</span>
              </div>
              <div class="answer" id="a3">
                <p>Hôte : Debian/Ubuntu avec Docker & Docker Compose. Dossiers persistants :</p>
<pre><code class="language-bash">sudo mkdir -p /home/maarch/courrier/{docservers,custom,librairies,cron}
sudo chown -R $USER:$USER /home/maarch/courrier
</code></pre>
                <p>Fichier <code>.env</code> (exemple) :</p>
<pre><code class="language-ini">APP_PORT=8080
DOCSERVERS_ROOT_PATH=/home/maarch/courrier/docservers
CUSTOM_PATH=/home/maarch/courrier/custom
LIBRAIRIES_PATH=/home/maarch/courrier/librairies
CRON_CONFIGURATION_PATH=/home/maarch/courrier/cron
MAARCH_TMP_DIR=/tmp

# OnlyOffice
ONLYOFFICE_PORT=4242
ONLYOFFICE_JWT_SECRET=my_jwt_secret
</code></pre>
              </div>
            </div>

            <!-- 5) Docker Compose -->
            <div class="faq-item">
              <div class="question" onclick="toggleAnswer('a4', this)">
                5) Docker Compose (Maarch + DB + OnlyOffice)
                <span class="arrow-icon">▼</span>
              </div>
              <div class="answer" id="a4">
<pre><code class="language-yaml">version: "3.8"

services:
  db-mc:
    image: postgres:16-alpine
    container_name: db-mc
    environment:
      POSTGRES_DB: MaarchCourrier
      POSTGRES_USER: maarch
      POSTGRES_PASSWORD: maarch
    volumes:
      - db-data:/var/lib/postgresql/data
      - sql-path:/home/sql
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U maarch -d MaarchCourrier || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 10

  app-mc:
    image: registry.maarch.org/maarch/maarchcourrier:latest
    container_name: app-mc
    depends_on:
      db-mc:
        condition: service_healthy
    environment:
      MAARCH_TMP_DIR: ${MAARCH_TMP_DIR}
      # BDD finalisée via l'installeur web : host=db-mc, user=maarch, pass=maarch, db=MaarchCourrier
    volumes:
      - ${DOCSERVERS_ROOT_PATH}:/opt/maarch/docservers
      - ${CUSTOM_PATH}:/var/www/html/MaarchCourrier/custom
      - ${LIBRAIRIES_PATH}:/var/www/html/MaarchCourrier/librairies
    ports:
      - "${APP_PORT}:80"
    healthcheck:
      test: ["CMD-SHELL", "curl -fsS http://localhost/ || exit 1"]
      interval: 20s
      timeout: 5s
      retries: 10
    restart: unless-stopped

  onlyoffice:
    image: onlyoffice/documentserver:8.3.3
    container_name: onlyoffice
    environment:
      JWT_ENABLED: "true"
      JWT_SECRET: ${ONLYOFFICE_JWT_SECRET}
    ports:
      - "${ONLYOFFICE_PORT}:80"
    restart: unless-stopped

volumes:
  db-data:
  sql-path:
</code></pre>
                <p class="soft">Lancement : <code>docker compose -p mc_24 -f compose.yml --env-file .env up -d</code></p>
                <p class="soft">Vérifs :</p>
<pre><code class="language-bash">docker ps
docker compose -p mc_24 logs -f app-mc
docker compose -p mc_24 logs -f db-mc
docker compose -p mc_24 logs -f onlyoffice
</code></pre>
              </div>
            </div>

            <!-- 6) Initialisation Maarch -->
            <div class="faq-item">
              <div class="question" onclick="toggleAnswer('a5', this)">
                6) Initialisation de Maarch Courrier (assistant web)
                <span class="arrow-icon">▼</span>
              </div>
              <div class="answer" id="a5">
                <p>Accéder à <code>http://localhost:8080/</code> (ou IP mappée), puis renseigner :</p>
                <ul>
                  <li><strong>BDD</strong> : hôte <code>db-mc</code>, base <code>MaarchCourrier</code>, user <code>maarch</code>, pass <code>maarch</code>.</li>
                  <li><strong>Chemins</strong> : <code>/opt/maarch/docservers</code>, <code>/var/www/html/MaarchCourrier/custom</code>, <code>/var/www/html/MaarchCourrier/librairies</code>.</li>
                  <li><strong>Clé de chiffrement</strong> : générer et conserver côté hôte (secret).</li>
                </ul>
                <p>L’assistant crée le schéma SQL, le compte admin et finalise la configuration.</p>
              </div>
            </div>

            <!-- 7) OnlyOffice & intégration -->
            <div class="faq-item">
              <div class="question" onclick="toggleAnswer('a6', this)">
                7) Déploiement d’OnlyOffice & intégration
                <span class="arrow-icon">▼</span>
              </div>
              <div class="answer" id="a6">
                <p><strong>Démarrage DocumentServer</strong> (ex. hors Compose) :</p>
<pre><code class="language-bash">docker run -d -p 4242:80 \
  -e JWT_ENABLED=true \
  -e JWT_SECRET=my_jwt_secret \
  --restart=always \
  onlyoffice/documentserver:8.3.3
</code></pre>
                <p><strong>Intégration Maarch</strong> : URL <code>http://HOST:4242/</code> (ou réseau Docker : <code>http://onlyoffice/</code>), JWT Secret = <code>my_jwt_secret</code> (identique au conteneur).</p>
                <p>Activer les types (docx, xlsx, pptx) et tester l’ouverture/édition d’un document.</p>
              </div>
            </div>

            <!-- 8) Validation & tests -->
            <div class="faq-item">
              <div class="question" onclick="toggleAnswer('a7', this)">
                8) Validation & tests
                <span class="arrow-icon">▼</span>
              </div>
              <div class="answer" id="a7">
                <ul>
                  <li>Healthchecks OK (<code>docker ps</code>).</li>
                  <li>UI Maarch accessible → login admin.</li>
                  <li>Upload d’un fichier : présent dans <code>${DOCSERVERS_ROOT_PATH}</code> côté hôte.</li>
                  <li>Édition OnlyOffice : ouverture, modification et sauvegarde OK.</li>
                  <li>Persistance confirmée après redémarrage de la stack.</li>
                </ul>
              </div>
            </div>

            <!-- 9) Problèmes & corrections -->
            <div class="faq-item">
              <div class="question" onclick="toggleAnswer('a8', this)">
                9) Problèmes rencontrés & corrections
                <span class="arrow-icon">▼</span>
              </div>
              <div class="answer" id="a8">
                <ul>
                  <li><strong>Maarch ne voit pas la BDD</strong> : vérifier host/MDP (<code>db-mc</code>), <code>logs db-mc</code>.</li>
                  <li><strong>403/404 au premier accès</strong> : attente d’initialisation / healthcheck → vérifier <code>logs app-mc</code>.</li>
                  <li><strong>Permissions docservers</strong> : ajuster <code>chmod/chown</code> sur le volume côté hôte.</li>
                  <li><strong>OnlyOffice “connection refused”</strong> : port/URL → tester <code>curl http://HOST:4242/</code>.</li>
                  <li><strong>JWT error</strong> : secrets différents → aligner <code>ONLYOFFICE_JWT_SECRET</code> et la conf Maarch.</li>
                  <li><strong>Performances</strong> : surveiller <code>docker stats</code>, CPU/RAM/IO, activer caches si besoin.</li>
                </ul>
              </div>
            </div>

            <!-- 10) Résultats & repo -->
            <div class="faq-item">
              <div class="question" onclick="toggleAnswer('a9', this)">
                10) Résultats & enseignements
                <span class="arrow-icon">▼</span>
              </div>
              <div class="answer" id="a9">
                <ul>
                  <li>Stack <strong>industrialiser</strong> : Maarch + PostgreSQL + OnlyOffice, <strong>reproductible</strong> et persistante.</li>
                  <li>Intégration <strong>OnlyOffice (JWT)</strong> validée et fonctionnelle.</li>
                  <li>Base prête pour la prod : reverse-proxy/TLS, sauvegardes, supervision, external auth (LDAP).</li>
                </ul>
                <p>
                  <a class="btn-ghost" href="https://github.com/avisse/Maarch-Projet" target="_blank" rel="noopener">
                    Ouvrir le repo (Compose, .env & docs)
                  </a>
                </p>
              </div>
            </div>

          </div><!-- /col-12 -->

        </div><!-- /row -->
      </div><!-- /container -->
    </section><!-- End Portfolio Details -->
  </main><!-- End #main -->

  <a href="#" class="back-to-top"><i class="bx bx-up-arrow-alt"></i></a>
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/jquery/jquery.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/jquery.easing/jquery.easing.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/waypoints/jquery.waypoints.min.js"></script>
  <script src="assets/vendor/counterup/counterup.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/venobox/venobox.min.js"></script>
  <script src="assets/vendor/owl.carousel/owl.carousel.min.js"></script>
  <script src="assets/vendor/typed.js/typed.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

  <!-- Accordéons -->
  <script>
    function toggleAnswer(answerId, question){
      var answer = document.getElementById(answerId);
      answer.classList.toggle("answer-visible");
      question.classList.toggle("answer-visible");
      if (answer.style.maxHeight){
        answer.style.maxHeight = null;
      } else {
        answer.style.maxHeight = answer.scrollHeight + "px";
      }
    }
  </script>
</body>
</html>
